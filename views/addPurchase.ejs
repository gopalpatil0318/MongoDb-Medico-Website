<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Management System</title>
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="./css/addMedicine.css">
    <link rel="stylesheet" href="./css/addPurchase.css">

    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;0,900;1,500;1,700;1,900&display=swap"
        rel="stylesheet">

        
        <style>

            @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600&display=swap');
    
            *{
                font-family: Arial, Helvetica, sans-serif;
                font-family: 'Rubik', sans-serif;
            }
    
            body{
                background-color: #ebf4f2;
            }
    
            .big-heading{
                background: #6bae9c;    
                font-weight: 600;
                font-size: 20px;
                padding: 20px;
                color: #fff;
            }
    
            .container-heading h2{
                
                border-radius: 20px;
                width: 30%;
                margin: auto;
                color: #6bae9c;
                margin-top: 70px;
               
            }
            
            .main-container{
                background-color: #fff;
                box-shadow: 0px 5px 20px 5px #cee4de80;
                width: 70%;
                margin: auto;
                z-index: -1;
                
                margin-bottom: 100px !important;
                padding: 50px;
                box-sizing: border-box;
                
            }
    
            .main-container input, .main-container select{
                width: 100%;
                padding: 20px;
                box-sizing: border-box;
                border-radius: 2px;
                background: #cee4de50;
                margin-bottom: 15px;
                border: none;
                margin-top: 5px;
            }
    
            .main-container label{
                color: #6bae9c;
            }
    
            .main-container button{
                background: linear-gradient(to bottom right, #14d8e8, #56f99f);
                padding: 15px 50px;
                border-radius: 5px;
                color: #000;
                border: none;
                font-weight: bold;
                
            }

            table{
                text-align: left;
            }

            table input, table select{
                width: 95% !important;
            }

            table button{
                height: 50px;
                margin-bottom: 10px;
                margin-right: 10px;
            }

            hr{
                border: 2px solid #f2f2f2;
            }
    
        </style>


</head>

<body>

    <!-- Nav Bar -->
    <div class="big-heading">Medical Management System</div>
    <div class="navbar">
        <a href="/">Dashboard</a>
        <div class="dropdown">
            <button class="dropbtn">Invoice
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/newInvoice">Add New Invoice</a>
                <a href="/manageInvoice">Manage Invoice</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Customer
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/addCustomer">Add New Customer</a>
                <a href="/manageCustomer">Manage Customer</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Medicine
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/addMedicine">Add New Medicine</a>
                <a href="/manageMedicine">Manage Medicine</a>
                <a href="/manageMedicineStock">Manage Medicine Stock</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Supplier
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/addSupplier">Add New Supplier</a>
                <a href="/manageSupplier">Manage Supplier</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Purchase
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/addPurchase">Add New Purchase</a>
                <a href="/managePurchase">Manage Purchase</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Report
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="#">Purchase Report</a>
                <a href="#">Sales Report</a>
            </div>
        </div>
    </div>

    <div class="container-heading"><h2>Add Purchase</h2></div>
    <!-- Add Purchase -->
    <div class="main-container">
        
        <div class="main-content">
            <form action="/addPurchase" method="POST">

                <div style="display: flex; gap: 10px;">
                    <div style="width: 50%;">
                        <label for="supplier">Supplier :</label>
                        <br>
                        <select name="supplier" id="supplier">
                            <% suppliers.forEach(supplier=> { %>
                                <option value="<%= supplier.sname %>">
                                    <%= supplier.sname %>
                                </option>
                                <% }); %>
                        </select>
                    </div>
                    <div style="width: 50%;">
                        <label for="inv_no">Invoice Number :</label>
                        <br>
                        <input type="text" name="inv_no" id="inv_no" placeholder="Invoice No">
                    </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                    <div style="width: 50%;">
                        <label for="pay_type">Payment Type : </label>
                        <br>
                        <select name="pay_type" id="pay_type">
                            <option value="cash">Cash</option>
                            <option value="Online">Online</option>
                        </select>
                    </div>
                    <div style="width: 50%;">
                        <label for="date">Date :</label>
                        <br>
                        <input type="date" name="date" id="date">
                    </div>
                </div>

                <div class="btn">
                    <button><a href="/addSupplier">Add Supplier</a></button>
                </div>
                <br>
                <hr>

                <div class="table-form">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 200px;">Medicine Name</th>
                                <th>Generic Name</th>
                                <th>Packing</th>
                                <th>Batch ID</th>
                                <th>EX.Date (mm/yy)</th>
                                <th>Quantity</th>
                                <th>MRP</th>
                                <th>Rate</th>
                                <th>Amount</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <select name="medicine_name" id="medicine_name">
                                        <% medicines.forEach(medicine=> { %>
                                            <option value="<%= medicine.medicine_name %>">
                                                <%= medicine.medicine_name %>
                                            </option>
                                            <% }); %>
                                    </select>
                                </td>
                                <td><input type="text" name="generic_name" id="generic_name" readonly></td>
                                <td><input type="text" id="packing" name="packing"></td>
                                <td><input type="text" id="batch_id" name="batch_id"></td>
                                <td> <input type="date" name="date1" id="date"></td>
                                <td><input type="text" name="quantity" class="quantity" placeholder="0"
                                        oninput="calculateAmount(this.parentNode.parentNode);"></td>
                                <td><input type="text" name="mrp" id="mrp"></td>
                                <td><input type="text" name="rate" class="rate" placeholder="0"
                                        oninput="calculateAmount(this.parentNode.parentNode);"></td>
                                <td><input type="text" name="amount" class="amount" readonly></td>
                                <td>
                                    <div style="display: flex;">
                                        <button style="padding: 10px 15px; height: 50px;" type="button" onclick="addNewMedicineRow()">Add</button>
                                        <button style="padding: 10px; height: 50px;" type="button">Delete</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="btn">
                        <button><a href="/addMedicine">Add New Medicine</a></button>
                    </div>
                    <br>
                    <hr>

                    <div class="grand-total">
                        <label for="total">Grand Total :</label>
                        <input type="text" id="total" name="grand_total" class="total" readonly>
                    </div>

                </div>

                <div class="btn-add">
                    <button type="submit">Add</button>
                </div>
            </form>
        </div>
    </div>

   
<script>
    function addNewMedicineRow() {
        // Get the table body
        var tableBody = document.querySelector("table tbody");

        // Clone the last row in the table
        var newRow = tableBody.rows[tableBody.rows.length - 1].cloneNode(true);

        // Clear input values in the cloned row
        var inputs = newRow.querySelectorAll('input');
        inputs.forEach(function (input) {
            input.value = '';
        });

        // Append the cloned row to the table
        tableBody.appendChild(newRow);
    }

    function calculateAmount(row) {
        var quantity = row.querySelector(".quantity").value;
        var rate = row.querySelector(".rate").value;
        var amount = quantity * rate;

        row.querySelector(".amount").value = amount;
        calculateGrandTotal();
    }

    function calculateGrandTotal() {
        var amounts = document.querySelectorAll(".amount");
        var grandTotal = 0;

        amounts.forEach(function (element) {
            grandTotal += parseFloat(element.value) || 0;
        });

        document.getElementById("total").value = grandTotal;
    }
</script>
<script>
    const medicineDropdown = document.getElementById('medicine_name');
    const genericNameInput = document.getElementById('generic_name');

    medicineDropdown.addEventListener('change', () => {
        const selectedMedicine = medicineDropdown.value;

        // Fetch the associated Generic Name using an AJAX request
        // Replace this URL with the actual endpoint to fetch Generic Name based on Medicine Name
        fetch(`/api/getGenericName?medicine=${selectedMedicine}`)
            .then(response => response.json())
            .then(data => {
                // Update the Generic Name input field
                genericNameInput.value = data.genericName;
            })
            .catch(error => console.error('Error fetching Generic Name:', error));
    });
</script>
</body>

</html>