<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Management System</title>
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="./css/addMedicine.css">
    <link rel="stylesheet" href="./css/addPurchase.css">

    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;0,900;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
</head>

<body>

    <!-- Nav Bar -->
    <div class="big-heading">Medical Management System</div>
    <div class="navbar">
        <a href="/">Dashboard</a>
        <div class="dropdown">
            <button class="dropbtn">Invoice
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/newInvoice">Add New Invoice</a>
                <a href="/manageInvoice">Manage Invoice</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Customer
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/addCustomer">Add New Customer</a>
                <a href="/manageCustomer">Manage Customer</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Medicine
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/addMedicine">Add New Medicine</a>
                <a href="/manageMedicine">Manage Medicine</a>
                <a href="/manageMedicineStock">Manage Medicine Stock</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Supplier
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/addSupplier">Add New Supplier</a>
                <a href="/manageSupplier">Manage Supplier</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Purchase
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/addPurchase">Add New Purchase</a>
                <a href="/managePurchase">Manage Purchase</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Report
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="../report/purchaseReport.html">Purchase Report</a>
                <a href="../report/salesReport.html">Sales Report</a>
            </div>
        </div>
    </div>

    <!-- Add Purchase -->
    <div class="main-container">
        <div class="container-heading">Add Purchase</div>
        <hr>
        <div class="main-content">
            <form action="/addPurchase" method="POST">

                <div class="main-div">
                    <div class="sec-div">
                        <label for="supplier">Supplier :</label>
                        <br>
                        <select name="supplier" id="supplier">
                            <% suppliers.forEach(supplier=> { %>
                                <option value="<%= supplier.sname %>">
                                    <%= supplier.sname %>
                                </option>
                                <% }); %>
                        </select>
                    </div>
                    <div class="sec-div">
                        <label for="inv_no">Invoice Number :</label>
                        <br>
                        <input type="text" name="inv_no" id="inv_no" placeholder="Invoice No">
                    </div>
                    <div class="sec-div">
                        <label for="pay_type">Payment Type : </label>
                        <br>
                        <select name="pay_type" id="pay_type">
                            <option value="cash">Cash</option>
                            <option value="Online">Online</option>
                        </select>
                    </div>
                    <div class="sec-div">
                        <label for="date">Date :</label>
                        <br>
                        <input type="date" name="date" id="date">
                    </div>
                </div>

                <div class="btn">
                    <button><a href="/addSupplier">Add Supplier</a></button>
                </div>
                <hr>

                <div class="table-form">
                    <table>
                        <thead>
                            <tr>
                                <th>Medicine Name</th>
                                <th>Generic Name</th>
                                <th>Packing</th>
                                <th>Batch ID</th>
                                <th>EX.Date (mm/yy)</th>
                                <th>Quantity</th>
                                <th>MRP</th>
                                <th>Rate</th>
                                <th>Amount</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <select name="medicine_name" id="medicine_name">
                                        <% medicines.forEach(medicine=> { %>
                                            <option value="<%= medicine.medicine_name %>">
                                                <%= medicine.medicine_name %>
                                            </option>
                                            <% }); %>
                                    </select>
                                </td>
                                <td><input type="text" name="generic_name" id="generic_name" readonly></td>
                                <td><input type="text" id="packing" name="packing"></td>
                                <td><input type="text" id="batch_id" name="batch_id"></td>
                                <td> <input type="date" name="date1" id="date"></td>
                                <td><input type="text" name="quantity" class="quantity" placeholder="0"
                                        oninput="calculateAmount(this.parentNode.parentNode);"></td>
                                <td><input type="text" name="mrp" id="mrp"></td>
                                <td><input type="text" name="rate" class="rate" placeholder="0"
                                        oninput="calculateAmount(this.parentNode.parentNode);"></td>
                                <td><input type="text" name="amount" class="amount" readonly></td>
                                <td>
                                    <div class="btn-g">
                                        <button class="add-btn" type="button" onclick="addNewMedicineRow()">Add</button>
                                        <button class="del-btn" type="button">Delete</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="btn">
                        <button><a href="/addMedicine">Add New Medicine</a></button>
                    </div>
                    <hr>

                    <div class="grand-total">
                        <label for="total">Grand Total :</label>
                        <input type="text" id="total" name="grand_total" class="total" readonly>
                    </div>

                </div>

                <div class="btn-add">
                    <button type="submit">Add</button>
                </div>
            </form>
        </div>
    </div>

   
<script>
    function addNewMedicineRow() {
        // Get the table body
        var tableBody = document.querySelector("table tbody");

        // Clone the last row in the table
        var newRow = tableBody.rows[tableBody.rows.length - 1].cloneNode(true);

        // Clear input values in the cloned row
        var inputs = newRow.querySelectorAll('input');
        inputs.forEach(function (input) {
            input.value = '';
        });

        // Append the cloned row to the table
        tableBody.appendChild(newRow);
    }

    function calculateAmount(row) {
        var quantity = row.querySelector(".quantity").value;
        var rate = row.querySelector(".rate").value;
        var amount = quantity * rate;

        row.querySelector(".amount").value = amount;
        calculateGrandTotal();
    }

    function calculateGrandTotal() {
        var amounts = document.querySelectorAll(".amount");
        var grandTotal = 0;

        amounts.forEach(function (element) {
            grandTotal += parseFloat(element.value) || 0;
        });

        document.getElementById("total").value = grandTotal;
    }
</script>
<script>
    const medicineDropdown = document.getElementById('medicine_name');
    const genericNameInput = document.getElementById('generic_name');

    medicineDropdown.addEventListener('change', () => {
        const selectedMedicine = medicineDropdown.value;

        // Fetch the associated Generic Name using an AJAX request
        // Replace this URL with the actual endpoint to fetch Generic Name based on Medicine Name
        fetch(`/api/getGenericName?medicine=${selectedMedicine}`)
            .then(response => response.json())
            .then(data => {
                // Update the Generic Name input field
                genericNameInput.value = data.genericName;
            })
            .catch(error => console.error('Error fetching Generic Name:', error));
    });
</script>
</body>

</html>